<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>京都自転車ルート可視化</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.js"></script>
    <link href="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.css" rel="stylesheet">
    <style>
        body { margin: 0; padding: 0; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
        #info {
            position: absolute;
            top: 10px;
            left: 10px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            max-width: 350px;
            max-height: 80vh;
            overflow-y: auto;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            font-size: 14px;
        }
        #info h2 {
            margin: 0 0 15px 0;
            font-size: 18px;
            border-bottom: 2px solid #333;
            padding-bottom: 8px;
        }
        .route-item {
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 6px;
            background: #f8f9fa;
        }
        .route-item h3 {
            margin: 0 0 8px 0;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .color-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
        }
        .route-item p {
            margin: 4px 0;
            color: #555;
            font-size: 12px;
        }
        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 5px;
            margin-top: 8px;
        }
        .stat {
            background: white;
            padding: 5px 8px;
            border-radius: 4px;
            font-size: 11px;
        }
        .stat-label { color: #888; }
        .stat-value { font-weight: bold; color: #333; }
        .legend {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #ddd;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 5px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <div id="info">
        <h2>京都自転車ルート可視化</h2>
        <div id="routes-list"></div>
        <div class="legend">
            <div class="legend-item">
                <span style="width:20px;height:3px;background:#e74c3c;display:inline-block;"></span>
                <span>元の座標（細かい）</span>
            </div>
            <div class="legend-item">
                <span style="width:20px;height:3px;background:#3498db;display:inline-block;border-style:dashed;"></span>
                <span>簡略化後の座標</span>
            </div>
        </div>
    </div>

    <script>
        mapboxgl.accessToken = 'pk.eyJ1IjoiYW9pOCIsImEiOiJjbWpwYnhrcmQxejljM2dxMWhwOWNhaWliIn0.4OAekJi1XmbCXRQe9HzJSA';

        const map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/streets-v12',
            center: [135.7588, 35.0116],  // 京都市中心
            zoom: 12
        });

        const routes = [{"name": "ルート1: 京都駅 → 金閣寺", "origin_name": "京都駅", "destination_name": "金閣寺", "distance": 8577.83050419402, "original_coordinates": [[135.7590742, 34.986622], [135.7582268, 34.9866126], [135.7581986, 34.9867262], [135.7576615, 34.9868512], [135.7575336, 34.9869467], [135.7575367, 34.9871506], [135.7567698, 34.9871428], [135.7552691, 34.9871233], [135.7538103, 34.9871243], [135.753835, 34.9871816], [135.7538537, 34.9879375], [135.7538393, 34.9883429], [135.7538249, 34.9887508], [135.7538164, 34.9892289], [135.7537964, 34.9903554], [135.7537727, 34.9915071], [135.7530951, 34.9914949], [135.7529658, 34.9914926], [135.7528427, 34.9929161], [135.7526333, 34.9931182], [135.7524475, 34.9936986], [135.7524199, 34.9944108], [135.7523858, 34.9952628], [135.7523724, 34.9959499], [135.7523099, 34.9961873], [135.7522451, 34.9963868], [135.7521867, 34.9966146], [135.7521704, 34.9979958], [135.7520261, 34.9988095], [135.7519795, 35.0001694], [135.7519822, 35.0012804], [135.7520019, 35.0024864], [135.751874, 35.0036375], [135.7516658, 35.0049423], [135.7516362, 35.0061315], [135.7516112, 35.0073309], [135.7516637, 35.0085553], [135.7516647, 35.0097667], [135.7516736, 35.0109295], [135.7516264, 35.0118302], [135.7516305, 35.0120768], [135.7516314, 35.0128002], [135.7516524, 35.0140665], [135.751708, 35.0157463], [135.7517379, 35.0173581], [135.7517299, 35.0187127], [135.7517438, 35.0199642], [135.7517388, 35.0211859], [135.7517254, 35.0225962], [135.7517259, 35.0235398], [135.7517063, 35.0249791], [135.75167, 35.0263787], [135.7517229, 35.0269852], [135.7513779, 35.0269972], [135.7505786, 35.02701], [135.7498578, 35.0270229], [135.7498961, 35.0276591], [135.749949, 35.0285012], [135.7489156, 35.0285644], [135.7470346, 35.0286123], [135.7470608, 35.029243], [135.7470916, 35.0298315], [135.7454594, 35.0298719], [135.7445528, 35.0298591], [135.7426877, 35.0297298], [135.7423924, 35.0296656], [135.7423274, 35.0297404], [135.7421583, 35.0309664], [135.7419602, 35.0316601], [135.7417048, 35.0325521], [135.7414452, 35.0334339], [135.741214, 35.0342918], [135.7409759, 35.0349901], [135.7407299, 35.0355006], [135.740414, 35.03607], [135.7402091, 35.0364394], [135.7400423, 35.0367399], [135.739929, 35.0369441], [135.7396301, 35.0377117], [135.7393802, 35.0384527], [135.7390533, 35.0393594], [135.7387502, 35.0402573], [135.7385133, 35.0408256], [135.7377735, 35.0407563], [135.7370458, 35.0406833], [135.7366681, 35.0406425], [135.73564, 35.0405337], [135.7345892, 35.0404284], [135.7339153, 35.0402769], [135.7335607, 35.0395856], [135.7333975, 35.03905], [135.7332841, 35.0390637], [135.7326659, 35.0391373], [135.7323638, 35.0381663], [135.73168, 35.038309], [135.7314747, 35.0384398], [135.7309354, 35.0378609], [135.7293298, 35.0378712]], "simplified_coordinates": [[135.7590742, 34.986622], [135.7582268, 34.9866126], [135.7575336, 34.9869467], [135.7575367, 34.9871506], [135.7538103, 34.9871243], [135.7537727, 34.9915071], [135.7529658, 34.9914926], [135.7528427, 34.9929161], [135.7524475, 34.9936986], [135.7523724, 34.9959499], [135.7521867, 34.9966146], [135.7520261, 34.9988095], [135.7520019, 35.0024864], [135.7516362, 35.0061315], [135.7517229, 35.0269852], [135.7498578, 35.0270229], [135.749949, 35.0285012], [135.7470346, 35.0286123], [135.7470916, 35.0298315], [135.7445528, 35.0298591], [135.7423924, 35.0296656], [135.7421583, 35.0309664], [135.7409759, 35.0349901], [135.739929, 35.0369441], [135.7385133, 35.0408256], [135.7339153, 35.0402769], [135.7333975, 35.03905], [135.7326659, 35.0391373], [135.7323638, 35.0381663], [135.7314747, 35.0384398], [135.7309354, 35.0378609], [135.7293298, 35.0378712]], "original_count": 98, "simplified_count": 32}, {"name": "ルート2: 京都駅 → 二条城", "origin_name": "京都駅", "destination_name": "二条城", "distance": 4772.129818968449, "original_coordinates": [[135.7590742, 34.986622], [135.7582268, 34.9866126], [135.7581986, 34.9867262], [135.7576615, 34.9868512], [135.7575336, 34.9869467], [135.7575367, 34.9871506], [135.7567698, 34.9871428], [135.7552691, 34.9871233], [135.7538103, 34.9871243], [135.753835, 34.9871816], [135.7538537, 34.9879375], [135.7538393, 34.9883429], [135.7538249, 34.9887508], [135.7538164, 34.9892289], [135.7537964, 34.9903554], [135.7537727, 34.9915071], [135.7530951, 34.9914949], [135.7529658, 34.9914926], [135.7528427, 34.9929161], [135.7526333, 34.9931182], [135.7524475, 34.9936986], [135.7524199, 34.9944108], [135.7523858, 34.9952628], [135.7523724, 34.9959499], [135.7523099, 34.9961873], [135.7522451, 34.9963868], [135.7521867, 34.9966146], [135.7521704, 34.9979958], [135.7520261, 34.9988095], [135.7519795, 35.0001694], [135.7519822, 35.0012804], [135.7520019, 35.0024864], [135.751874, 35.0036375], [135.7516658, 35.0049423], [135.7516362, 35.0061315], [135.7516112, 35.0073309], [135.7516637, 35.0085553], [135.7516647, 35.0097667], [135.7516736, 35.0109295], [135.7516264, 35.0118302], [135.7516305, 35.0120768], [135.7515197, 35.0126605], [135.751524, 35.013011], [135.7515564, 35.0139832], [135.7515666, 35.0155115], [135.7515614, 35.0157537], [135.7511236, 35.0157777], [135.7505147, 35.0158041], [135.7502225, 35.0158165], [135.7502104, 35.0154762], [135.7499915, 35.0153702], [135.7493018, 35.0149968], [135.7489791, 35.0151419], [135.7485464, 35.0150871], [135.7483805, 35.014953], [135.7482742, 35.0149604], [135.7464779, 35.0150215], [135.7464796, 35.0148746], [135.7464892, 35.0142208], [135.7473031, 35.0139195], [135.7471914, 35.0137763], [135.7475045, 35.013678], [135.7474665, 35.0136056], [135.7479917, 35.0135838], [135.7480154, 35.0136808], [135.7481364, 35.0137377], [135.748246, 35.0139942]], "simplified_coordinates": [[135.7590742, 34.986622], [135.7582268, 34.9866126], [135.7575336, 34.9869467], [135.7575367, 34.9871506], [135.7538103, 34.9871243], [135.7537727, 34.9915071], [135.7529658, 34.9914926], [135.7528427, 34.9929161], [135.7524475, 34.9936986], [135.7523724, 34.9959499], [135.7521867, 34.9966146], [135.7520019, 35.0024864], [135.7516658, 35.0049423], [135.7515614, 35.0157537], [135.7502225, 35.0158165], [135.7502104, 35.0154762], [135.7493018, 35.0149968], [135.7489791, 35.0151419], [135.7483805, 35.014953], [135.7464779, 35.0150215], [135.7464892, 35.0142208], [135.7473031, 35.0139195], [135.7471914, 35.0137763], [135.7474665, 35.0136056], [135.7479917, 35.0135838], [135.748246, 35.0139942]], "original_count": 67, "simplified_count": 26}, {"name": "ルート3: 四条烏丸 → 清水寺", "origin_name": "四条烏丸", "destination_name": "清水寺", "distance": 3885.464948821254, "original_coordinates": [[135.7596057, 35.0036577], [135.7597188, 35.0036577], [135.7610911, 35.003665], [135.7625917, 35.0036758], [135.7632741, 35.0036808], [135.7639955, 35.003686], [135.764921, 35.0036927], [135.7655955, 35.0036976], [135.7663517, 35.0037031], [135.7668751, 35.0037162], [135.7671922, 35.0037181], [135.7688193, 35.0037574], [135.76932, 35.0037796], [135.7703792, 35.003802], [135.7705581, 35.0038055], [135.7710153, 35.0038155], [135.7705612, 35.0026868], [135.7704213, 35.0023702], [135.7713514, 35.0020341], [135.7714155, 35.0020124], [135.7698498, 34.998862], [135.7685123, 34.9956836], [135.7685685, 34.9956773], [135.7689938, 34.9956313], [135.7693974, 34.9955832], [135.7695156, 34.9955677], [135.7701123, 34.9954787], [135.7711215, 34.9953219], [135.7717732, 34.9952344], [135.7731049, 34.9949861], [135.7736081, 34.994862], [135.774384, 34.9946579], [135.7760928, 34.9943512], [135.776306, 34.9944243], [135.7768005, 34.9945779], [135.7768589, 34.9945998], [135.7771998, 34.9947286], [135.7774993, 34.9948406], [135.7792893, 34.9950347], [135.7792957, 34.9951824], [135.7793887, 34.9951782], [135.7798946, 34.995151], [135.7804144, 34.9948074], [135.7810115, 34.9947242], [135.7817662, 34.9950539], [135.7825595, 34.9950166], [135.7829169, 34.9955134], [135.7829976, 34.9955149], [135.7831365, 34.9957269], [135.7837679, 34.9956082], [135.7840943, 34.9955538], [135.7845859, 34.9955196], [135.7846518, 34.9953308]], "simplified_coordinates": [[135.7596057, 35.0036577], [135.7710153, 35.0038155], [135.7704213, 35.0023702], [135.7714155, 35.0020124], [135.7698498, 34.998862], [135.7685123, 34.9956836], [135.7717732, 34.9952344], [135.7760928, 34.9943512], [135.7774993, 34.9948406], [135.7792893, 34.9950347], [135.7792957, 34.9951824], [135.7798946, 34.995151], [135.7804144, 34.9948074], [135.7810115, 34.9947242], [135.7817662, 34.9950539], [135.7825595, 34.9950166], [135.7831365, 34.9957269], [135.7845859, 34.9955196], [135.7846518, 34.9953308]], "original_count": 53, "simplified_count": 19}, {"name": "ルート4: 金閣寺 → 銀閣寺", "origin_name": "金閣寺", "destination_name": "銀閣寺", "distance": 18584.805794921307, "original_coordinates": [[135.7293298, 35.0378712], [135.728277, 35.0379625], [135.7281044, 35.0380336], [135.7279846, 35.0381638], [135.7278598, 35.0383276], [135.7274794, 35.0389483], [135.7270258, 35.0393735], [135.7264874, 35.0400687], [135.7264732, 35.0400833], [135.726138, 35.0407382], [135.7259019, 35.041028], [135.7258425, 35.0411596], [135.7245262, 35.0458228], [135.7238129, 35.0458282], [135.7227541, 35.0489524], [135.7216942, 35.04982], [135.7217631, 35.0500788], [135.7217901, 35.0507882], [135.7255744, 35.0549881], [135.7257829, 35.0551534], [135.7267408, 35.0553836], [135.7224411, 35.0590063], [135.7192858, 35.0672292], [135.717982, 35.0701695], [135.7183862, 35.075447], [135.7184248, 35.0764371], [135.7209916, 35.0803831], [135.7236646, 35.0759217], [135.727808, 35.070547], [135.7389354, 35.0693569], [135.7392031, 35.0691842], [135.740293, 35.0681599], [135.7406089, 35.0680171], [135.7411533, 35.0681113], [135.7412497, 35.0676025], [135.7420006, 35.0676719], [135.7423261, 35.0672203], [135.7426683, 35.0667645], [135.7429885, 35.0663493], [135.7438637, 35.0668161], [135.7441771, 35.0663867], [135.7446956, 35.0666465], [135.7449458, 35.0663317], [135.7546519, 35.053634], [135.7553258, 35.0531351], [135.7559098, 35.0526516], [135.7582276, 35.0498679], [135.7657399, 35.0386754], [135.7665734, 35.0372342], [135.7656783, 35.0378852], [135.7661739, 35.0370907], [135.766886, 35.0360447], [135.767527, 35.0350904], [135.7679636, 35.0344628], [135.7680698, 35.0342939], [135.7685866, 35.0334951], [135.7689733, 35.0328889], [135.7697415, 35.0317675], [135.7704851, 35.0304523], [135.7704974, 35.0304221], [135.7705391, 35.030237], [135.7704805, 35.0291491], [135.7706988, 35.0291267], [135.7724313, 35.0289619], [135.7725199, 35.0289517], [135.7736125, 35.0288359], [135.7742935, 35.0287657], [135.7750291, 35.0286944], [135.7755935, 35.0286624], [135.7774704, 35.0287916], [135.778747, 35.0288703], [135.7792271, 35.0288368], [135.7793222, 35.0288304], [135.7816318, 35.0285989], [135.7823456, 35.0285865], [135.783044, 35.0285909], [135.7842716, 35.0285882], [135.7844276, 35.0286146], [135.7846291, 35.0286488], [135.7849205, 35.0286981], [135.7853369, 35.0287674], [135.7853932, 35.0287757], [135.7855328, 35.0288009], [135.7870398, 35.02973], [135.7866495, 35.0289232], [135.7870282, 35.028857], [135.7871365, 35.028835], [135.7895795, 35.0283254], [135.7902104, 35.0282031], [135.7903513, 35.028169], [135.7907464, 35.028083], [135.7914178, 35.0279225], [135.7914981, 35.0279178], [135.7924744, 35.0277166], [135.7925985, 35.0276916], [135.7931277, 35.027576], [135.7942873, 35.027325], [135.7943763, 35.0275047], [135.7947763, 35.0274026], [135.7951097, 35.0272421], [135.7957943, 35.0273506], [135.7957969, 35.0274964], [135.7958017, 35.027578], [135.7972784, 35.0276035], [135.797277, 35.0274349], [135.7975009, 35.0274372]], "simplified_coordinates": [[135.7293298, 35.0378712], [135.7281044, 35.0380336], [135.7264732, 35.0400833], [135.7258425, 35.0411596], [135.7245262, 35.0458228], [135.7238129, 35.0458282], [135.7227541, 35.0489524], [135.7216942, 35.04982], [135.7217901, 35.0507882], [135.7255744, 35.0549881], [135.7267408, 35.0553836], [135.7224411, 35.0590063], [135.7192858, 35.0672292], [135.717982, 35.0701695], [135.7184248, 35.0764371], [135.7209916, 35.0803831], [135.7236646, 35.0759217], [135.727808, 35.070547], [135.7389354, 35.0693569], [135.740293, 35.0681599], [135.7406089, 35.0680171], [135.7411533, 35.0681113], [135.7412497, 35.0676025], [135.7420006, 35.0676719], [135.7429885, 35.0663493], [135.7438637, 35.0668161], [135.7441771, 35.0663867], [135.7446956, 35.0666465], [135.7546519, 35.053634], [135.7559098, 35.0526516], [135.7582276, 35.0498679], [135.7657399, 35.0386754], [135.7665734, 35.0372342], [135.7656783, 35.0378852], [135.7704851, 35.0304523], [135.7704805, 35.0291491], [135.7755935, 35.0286624], [135.778747, 35.0288703], [135.7816318, 35.0285989], [135.7842716, 35.0285882], [135.7855328, 35.0288009], [135.7870398, 35.02973], [135.7866495, 35.0289232], [135.7942873, 35.027325], [135.7943763, 35.0275047], [135.7951097, 35.0272421], [135.7957943, 35.0273506], [135.7958017, 35.027578], [135.7972784, 35.0276035], [135.797277, 35.0274349], [135.7975009, 35.0274372]], "original_count": 106, "simplified_count": 51}];
        const colors = ["#e74c3c", "#3498db", "#2ecc71", "#f39c12", "#9b59b6"];

        map.on('load', () => {
            const bounds = new mapboxgl.LngLatBounds();
            const routesList = document.getElementById('routes-list');

            routes.forEach((route, index) => {
                const color = colors[index % colors.length];
                const simplifiedColor = '#2980b9';

                // 元のルート（実線）
                map.addSource(`route-original-${index}`, {
                    type: 'geojson',
                    data: {
                        type: 'Feature',
                        geometry: {
                            type: 'LineString',
                            coordinates: route.original_coordinates
                        }
                    }
                });

                map.addLayer({
                    id: `route-original-${index}`,
                    type: 'line',
                    source: `route-original-${index}`,
                    layout: {
                        'line-join': 'round',
                        'line-cap': 'round'
                    },
                    paint: {
                        'line-color': color,
                        'line-width': 4,
                        'line-opacity': 0.7
                    }
                });

                // 簡略化後のルート（破線）
                map.addSource(`route-simplified-${index}`, {
                    type: 'geojson',
                    data: {
                        type: 'Feature',
                        geometry: {
                            type: 'LineString',
                            coordinates: route.simplified_coordinates
                        }
                    }
                });

                map.addLayer({
                    id: `route-simplified-${index}`,
                    type: 'line',
                    source: `route-simplified-${index}`,
                    layout: {
                        'line-join': 'round',
                        'line-cap': 'round'
                    },
                    paint: {
                        'line-color': simplifiedColor,
                        'line-width': 3,
                        'line-dasharray': [2, 2],
                        'line-opacity': 0.9
                    }
                });

                // 始点マーカー
                new mapboxgl.Marker({ color: '#27ae60' })
                    .setLngLat(route.original_coordinates[0])
                    .setPopup(new mapboxgl.Popup().setHTML(`<b>${route.name}</b><br>始点: ${route.origin_name}`))
                    .addTo(map);

                // 終点マーカー
                new mapboxgl.Marker({ color: '#c0392b' })
                    .setLngLat(route.original_coordinates[route.original_coordinates.length - 1])
                    .setPopup(new mapboxgl.Popup().setHTML(`<b>${route.name}</b><br>終点: ${route.destination_name}`))
                    .addTo(map);

                // bounds更新
                route.original_coordinates.forEach(coord => bounds.extend(coord));

                // 情報パネル更新
                routesList.innerHTML += `
                    <div class="route-item">
                        <h3>
                            <span class="color-dot" style="background:${color}"></span>
                            ${route.name}
                        </h3>
                        <p>${route.origin_name} → ${route.destination_name}</p>
                        <div class="stats">
                            <div class="stat">
                                <div class="stat-label">距離</div>
                                <div class="stat-value">${(route.distance / 1000).toFixed(2)} km</div>
                            </div>
                            <div class="stat">
                                <div class="stat-label">元の座標数</div>
                                <div class="stat-value">${route.original_count} 点</div>
                            </div>
                            <div class="stat">
                                <div class="stat-label">簡略化後</div>
                                <div class="stat-value">${route.simplified_count} 点</div>
                            </div>
                            <div class="stat">
                                <div class="stat-label">削減率</div>
                                <div class="stat-value">${((1 - route.simplified_count / route.original_count) * 100).toFixed(1)}%</div>
                            </div>
                        </div>
                    </div>
                `;
            });

            // 全ルートが見えるようにズーム
            map.fitBounds(bounds, { padding: 50 });
        });
    </script>
</body>
</html>